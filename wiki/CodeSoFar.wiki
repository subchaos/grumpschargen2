#summary Current (but not necessarily working) copy of the code.
#labels Featured
=WORK IN PROGRESS=

The following code will change at my whim. May be updated regularly, may not. Comments/suggestions/modifications welcome - send along to woragrump@gmail.com.

{{{
@@ REQUIRED FEATURES - READ THIS FIRST!
@@ -
@@ You are going to need a Function Invocation Level of at least 10,000.
@@ -
@@ This code assumes you've created a stdheader, stdsubheader, and stdfooter for your game.
@@ -
@@ You are assumed to have an isstaff(dbref) function. The SGP Globals come with one.
@@ -
@@ GAME-SPECIFIC DIFFERENCES
@@ -
@@ This section is likely only interesting to coders, and maybe not even those. I apologize in advance for any system bias I am perceived to be displaying. Read on at your own risk.
@@ -
@@ itemize(<list>, <delim>) - equates to elist(<list>, <phrase>, <delim>) on Rhost. Rhost users may need to create a custom itemize function. There should be one included with the SGP Globals, however.
@@ iter() calls which are required to have no spaces have an output delimiter of @@ for MUX compatibility. Rhost users will need to change this to @@().
@@ -
@@ Since there's no ibreak() on MUX, I've used first(iter(blah, if(bleh, bloo|<term>|)), |<term>|). Waste of cycles, but easy to convert - just search for the first |<term>| and stick a [ibreak()] in its place, then remove the 'first(' and the ', |<term>|)'. Note that you will have to do this by hand (or at least look before hitting replace all) because first( is used elsewhere in the code. Or you could just leave it as is - not like nowadays we can't afford the extra cycles.
@@ -
@@ streq() has been replaced with eq(comp(string1, string2), 0) for MUX compatibility.
@@ -





@create Chargen DB Holder <CDH>=10
@set CDH=HALT INHERIT
@force me=&CDH me=num(CDH)

&stafflock CDH=isstaff(%0)
@lock/use CDH=stafflock/1

&fn-getstatdbref CDH=if(t(setr(0, first(iter(lcon(me), if(strmatch(name(itext(0)), %0), itext(0)|<term>|)), |<term>|))), %q0, #-1 COULD NOT GET STAT DBREF FOR %0.)

&fn-getstat CDH=if(t(%2), if(t(setr(0, ulocal(fn-getstatdbref, %2))), u(%q0/fn-getstat, %0, %1), %q0), if(t(setr(0, first(iter(lcon(me), if(t(member(get(itext(0)/valid_stat_names), %1, |)), ulocal(itext(0)/fn-getstat, %0, %1)|<term>|)), |<term>|))), %q0, if(t(words(%q0)), %q0, #-1 COULD NOT FIND STAT %1 for %0. STAT TYPE NOT PROVIDED.)))

&fn-getstatdetail CDH=if(t(%2), if(t(setr(0, ulocal(fn-getstatdbref, %2))), u(%q0/fn-getstatdetail, %0, %1), %q0), if(t(setr(0, first(iter(lcon(me), if(t(member(lattr(itext(0), detail-*), detail-%1)), ulocal(itext(0)/fn-getstatdetail, %0, %1)|<term>|)), |<term>|))), %q0, if(t(words(%q0)), %q0, #-1 COULD NOT FIND STAT DETAIL %1 for %0. STAT TYPE NOT PROVIDED.)))




@create NWoD Races <NR>=10
@set NR=HALT INHERIT
@force me=@parent NR=v(CDH)
@lock/use NR=stafflock/1
@force me=&NR me=num(NR)

&valid_stat_names NR=Race

&valid_stat_values NR=Mortal|Changeling

&detail-attribute_balance NR=5 4 3

&fn-getstat NR=default(%0/_race, Mortal)

&fn-getstatdetail NR=udefault(u(fn-getstat, %0)-dbref/detail-%1, udefault(me/detail-%1, #-1 ERROR GETTING STAT DETAIL %1 FOR %0.))




@create NWoD Mortal <NM>=10
@set NM=HALT INHERIT
@force me=@parent NM=v(NR)
@lock/use NM=stafflock/1
@force me=&mortal-dbref NR=num(NM)




@create NWoD Changeling <NC>=10
@set NC=HALT INHERIT
@force me=@parent NC=v(NR)
@lock/use NC=stafflock/1
@force me=&changeling-dbref NR=num(NC)

&detail-attribute_balance NC=5 4 3




@create NWoD Attributes <NA>=10
@set NA=HALT INHERIT
@force me=@parent NA=v(CDB)
@lock/use NA=stafflock/1

&valid_stat_names NA=Intelligence|Wits|Resolve|Strength|Dexterity|Stamina|Presence|Manipulation|Composure

&valid_stat_values NA=1|2|3|4|5|6|7|8|9|10

&fn-getstat NA=extract(setr(0, default(%0/_attributes, 0|0|0|0|0|0|0|0|0)), member(%q0, %1, |), 1, |)

&fn-get_valid_values NA=default(me/valid_%0_values, v(valid_stat_values))

&fn-get_cg_cost NA=if(t(setr(0, ulocal(fn-getstat, %0, %1, attribute))), if(eq(%q0, 5), 5, sub(%q0, 1)), 0)

&cgcheck-valid_values NA=iter(v(valid_stat_names), if(!t(member(setr(1, u(fn-get_valid_values)), setr(0, ulocal(fn-getstat, %0, itext(0))), |)), You must enter one of [itemize(%q1, |)] for [itext(0)].%R, if(lte(%q0, 0),The minimum allowable value for [itext(0)] is 1.%R, if(gt(%q0, 5), The maximum allowable value for [itext(0)] at character generation is 5.%R))), |, @@)

&cgcheck-attribute_balance NA=if(!eq(comp(setr(0, u(fn-getstatdetail, %0, attribute_balance)), setr(1, sort(ladd(ulocal(fn-get_cg_cost, %0, Strength) [ulocal(fn-get_cg_cost, %0, Dexterity)] [ulocal(fn-get_cg_cost, %0, Stamina)]) [ladd(ulocal(fn-get_cg_cost, %0, Intelligence) [ulocal(fn-get_cg_cost, %0, Wits)] [ulocal(fn-get_cg_cost, %0, Resolve)])] [ladd(ulocal(fn-get_cg_cost, %0, Presence) [ulocal(fn-get_cg_cost, %0, Manipulation)] [ulocal(fn-get_cg_cost, %0, Composure)])], n))), 0), You must spread your points among attributes in three groups of [itemize(%q0)]. You have [itemize(%q1)].%R)

&sheet-layout NA=stdsubheader(Attributes)%R %b[space(12)][center(Mental,20)] %b[center(Physical,19)] %b[center(Social,20)]%R %b[rjust(Power:,11)] [ljust(Intelligence:,14)] [rjust(u(fn-getstat,%0,Intelligence),5)] %b[ljust(Strength:,13)] [rjust(u(fn-getstat,%0,Strength),5)] %b[ljust(Presence:,14)] [rjust(u(fn-getstat,%0,Presence),5)]%R %b[rjust(Finesse:,11)] [ljust(Wits:,14)] [rjust(u(fn-getstat,%0,Wits),5)] %b[ljust(Dexterity:,13)] [rjust(u(fn-getstat,%0,Dexterity),5)] %b[ljust(Manipulation:,14)] [rjust(u(fn-getstat,%0,Manipulation),5)]%R %bResistance: [ljust(Resolve:,14)] [rjust(u(fn-getstat,%0,Resolve),5)] %b[ljust(Stamina:,13)] [rjust(u(fn-getstat,%0,Stamina),5)] %b[ljust(Composure:,14)] [rjust(u(fn-getstat,%0,Composure),5)]

}}}